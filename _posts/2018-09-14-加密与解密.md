## 加密种类

**对称加密：**加密解密使用同一密钥，加解密速度快。随着人数增多，密钥数量急增n(n-1)/2。

**非对称加密 ：**使用公私钥配对加解密，速度慢。公钥是从私钥中提取出来的，一般拿对方公钥加密来保证数据安全性，拿自己的私钥加密来证明数据来源的身份。

**单向加密：**不算是加密，也常称为散列运算，用于生成独一无二的校验码(或称为指纹、特征码)来保证数据的完整性和一致性，如MD5、SHA。具有雪崩效应，任何一点数据的改变，生成的校验码值变化非常大。

互联网数据安全可靠的条件：

1.数据来源可信，即数据发送者身份可信。

2.数据具备完整性，即数据未被修改过。

3.数据安全性，即数据不会被泄漏，他人截获后无法解密。

### 对称加密

DES：Data Encryption Standard，56bits 

3DES： 

AES：Advanced (128, 192, 256bits)   ----->目前主流使用的对称加密算法

Blowfish，Twofish 

IDEA，RC6，CAST5    

特性：
	1、加密、解密使用同一个密钥，效率高
	2、将原始数据分割成固定大小的块，逐个进行加密
缺陷：
	1、 密钥过多
	2、密钥分发
	3、数据来源无法确认

### 非对称加密

特点：用公钥加密数据，只能使用与之配对的私钥解密；反之亦然 

功能： 

​	数字签名：主要在于让接收方确认发送方身份 

​	对称密钥交换：发送方用对方的公钥加密一个对称密钥后发送给对方

​	数据加密：适合加密较小数据 

缺点：

​	密钥长，加密解密效率低下

算法： 

​	RSA（加密，数字签名） 

​	DSA（数字签名） 

​	ELGamal    

### 单向散列加密

功能：数据完整性
常见算法
md5: 128bits、 sha1: 160bits、 sha224、 sha256、 sha384、 sha512
常用工具
• md5sum | sha1sum [ --check ] file
• openssl、 gpg
• rpm -V

## 加密细节

对数据加密的方法各有利弊，要想保证数据的安全可靠条件，则需要将几个加密方法联合起来使用。

公私钥加密速度慢，对称加密速度快，因此可以先考虑对data数据进行对称加密，再进一步考虑，如果使用私钥进行加密的话，由于公钥是公开的，分发出去的，显然用私钥加密就会直接被破解，因此使用对方的公钥加密，也就只能使用对方的私钥解密，这样就确保了数据的安全性。

但是，此加密办法**没有实现数据的完整性、一致性以及数据来源的可靠性**。

数据的数据签名：

对于数据的完整性和一致性，我们可以通过单项加密算法，通过hash函数来计算出独一无二的校验码，可以称为**“数据摘要”**。

对于数据来源可靠性，我们可以使用自己的私钥去加密数据，因为公私钥是一对的，公钥分发出去，私钥想指纹一样，只能属于自己的，当对方拿你的公钥去配对成功的时候就能说明该数据来源是来自于你，但是私钥加密速度慢，所以私钥用来加密数据摘要，加密后称为**数字签名**。

用户通过手上发送方的公钥，就能解开私钥加密部分取出数据和数据摘要，由此可以确认了数据的来源可靠性，另外部分需要使用接收方的私钥进行配对解开取得，然后利用单向加密算法计算出数据摘要与对方的数据摘要进行对比，如果相等则说明数据没有被篡改过（一个空格都算是修改了，会导致数据摘要的巨大变化），则保证了数据的完整性和一致性。

## CA、PKI及信任CA

CA(Certificate Authority)是数字证书认证中心，常称为证书颁发机构，申请者提交自己的公钥和一些个人信息(如申请者国家，姓名，单位等)给CA，CA对申请者的这些信息单向加密生成摘要信息，然后使用自己的**私钥**加密整个摘要信息，这样就得到了CA对申请者的数字签名，在数字签名上再加上CA自己的一些信息(如CA的机构名称，CA层次路径等)以及该证书的信息(如证书有效期限)，就得到了所谓的数字证书。

如果某用户信任了CA，则获取了该CA的公钥。使用该公钥解密数字证书就可以验证申请者的信息以及申请者公钥的可靠性（申请者的公钥只被CA的私钥加密，解密该私钥后只是需要验证可靠性）。 

这里关键就是CA使用自己的私钥给申请者加密，那么如何保证CA自己是可以信任并且合法的呢？CA上面还有个根CA，通过自签署数字证书的形式标榜自己的合法性和可靠性，所以子CA是由根CA颁发合法证书的。

正是这些根CA和子CA组成了PKI。

信任CA后，每次接收到需要解密的数字证书时，还要去该颁发机构指定网站的**证书吊销列表（CRL）**中查询该证书是否被吊销，对于吊销后的证书应该不予以信任，这是信任CA的第二个作用。导致证书被吊销的可能性不少，例如申请者的私钥被黑客获取，申请者申请吊销等。

也有公司使用自签的证书，例如某些银行、12306有时候就要求下载证书并安装。使用自签证书的好处当然是省钱、方便啦。

## 数字证书类型和内容

证书类型：
	证书授权机构的证书
	服务器
	用户证书

获取证书两种方法：
	• 使用证书授权机构
		生成签名请求（csr）
		将csr发送给CA
		从CA处接收签名
	• 自签名的证书
		自已签发自己的公钥

## GPG工具

### 使用gpg实现对称加密

对称加密file文件
	#gpg -c file
	#ls file.gpg
在另一台主机上解密file
	#gpg -o file -d file.gpg

### 使用gpg工具实现公钥加密

在hostB主机上用公钥加密，在hostA主机上解密
在hostA主机上生成公钥/私钥对
	#gpg --gen-key
在hostA主机上查看公钥
	#gpg --list-keys
在hostA主机上导出公钥到wang.pubkey
	#gpg -a --export -o wang.pubkey
从hostA主机上复制公钥文件到需加密的B主机上
	#scp wang.pubkey hostB:

在hostB主机上导入公钥
	#gpg --import wang.pubkey
	#gpg --list-keys
用从hostA主机导入的公钥，加密hostB主机的文件file,生成file.gpg
	#gpg -e -r wangxiaochun file
	#file file.gpg

复制加密文件到hostA主机
	#scp fstab.gpg hostA:
在hostA主机解密文件
	#gpg -d file.gpg
	#gpg -o file -d file.gpg
删除公钥和私钥
	#gpg --delete-keys wangxiaochun
	#gpg --delete-secret-keys wangxiaochun

这种公钥加密，如果自己的私钥不小心泄露出去了，则容易被人伪装成中间人进行信息窃取或攻击。



## Openssl工具

OpenSSL：开源项目
	三个组件：
		openssl: 多用途的命令行工具，包openssl
		libcrypto: 加密算法库，包openssl-libs
		libssl：加密模块应用库，实现了ssl及tls，包nss

openssl命令： 

​	两种运行模式：交互模式和批处理模式 

​	openssl version：程序版本号

​	标准命令、消息摘要命令、加密命令 

​	标准命令： enc, ca, req, ...    

在给出openssl enc命令用法示例之前，先解释下对称加密和解密的原理和过程。

对称加解密时，它们使用的密码是完全相同的，例如"123456"，但这是密码，且是明文密码，非常不安全，所以应该对此简单密码进行复杂化。最直接的方法是使用单向加密计算出明文密码的hash值，单向加密后新生成的密码已经比较安全(称之为密钥比较好)，可以作为对称加密时的对称密钥。另外，由于同一单向加密算法对相同明文密码的计算结果是完全一致的，这样解密时使用相同的单向加密算法就能计算出完全相同的密钥，也就是解密时的对称密钥。如果想要更安全，还可以在对称加密后对加密文件进行重新编码，如使用"base64"、二进制或hex编码方式进行编码，但对应的在解密前就需要先解码，解码后才能解密。

所以，将对称加、解密的机制简单概括如下：

对称加密机制：根据指定的单向加密算法，对输入的明文密码进行单向加密(默认是md5)，得到固定长度的加密密钥，即对称密钥，再根据指定的对称加密算法，使用对称密钥加密文件，最后重新编码加密后的文件。即单向加密明文密码结果作为对称密钥、使用对称密钥加密文件、对文件重新编码。

对称解密机制：先解码文件，再根据单向加密算法对解密时输入的明文密码计算得到对称密钥，依此对称密钥对称解密解码后的文件。

因此，解密过程中使用的解码方式、单向加密和对称加密算法都必须一致，且输入的密码必须是正确密码。但需要注意的一点是，解密时可以不指定salt，因为加密时使用的salt会记录下来，解密时可以读取该salt。

## 实验：实现CA和证书申请

1 在CA上执行，建立CA
	#cd /etc/pki/CA
	#touch index.txt
	#echo 01 > serial
	#(umask 077;openssl genrsa -out private/cakey.pem 2048)
	#openssl req -new -x509 -key private/cakey.pem -out cacert.pem  -days 3650
填写多项内容：国家，省，城市，公司等

2 客户端执行
	#(umask 077;openssl genrsa -out /data/app.key 2048)
	#openssl req -new  -key /data/app.key -out /data/app.csr  
填写多项内容：国家，省，城市，公司等
	#scp /data/app.csr   到CA服务器上

3 在CA上执行，颁发证书
	#cd /etc/pki/CA
	#openssl ca -in app.csr  -out certs/app.crt -days 100 

4 验证证书
	#openssl verify -CAfile cacert.pem certs/app.crt certs/app2.crt
	OK

5 查看证书内容
	#openssl x509 -in certs/app.crt -noout -text 















